<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Rewrite-R-ecology-lesson: Putting it together</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [ ['$','$'], ['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav data"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Data Carpentry" src="assets/images/data-logo.svg"><abbr class="icon" title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught." style="text-decoration: unset">
           
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link" style="color: #383838">Pre-Alpha
            <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="color: #FF4955"></i>
          </a>
          <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container ">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/04-putting-it-together.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav data" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Data Carpentry" src="assets/images/data-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Rewrite-R-ecology-lesson
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
      <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Rewrite-R-ecology-lesson
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"></ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Rewrite-R-ecology-lesson
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 80%" class="percentage">
    80%
  </div>
  <div class="progress data">
    <div class="progress-bar data" role="progressbar" style="width: 80%" aria-valuenow="80" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
  <div id="sidebar-col" class="col-lg-4">
    <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle"><i class="search-icon" data-feather="x" role="img"></i></button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/04-putting-it-together.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="00-introduction-r-rstudio.html">1. Introduction to R and RStudio</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="01-visualizing-ggplot.html">2. Data visualization with ggplot2</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="02-how-r-thinks-about-data.html">3. Exploring and understanding data</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="03-working-with-data.html">4. Working with data</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        Putting it together
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#reading-the-new-surveys-data">Reading the new surveys data</a></li>
<li><a href="#reading-the-new-species-data">Reading the new species data</a></li>
<li><a href="#reading-the-new-plots-data">Reading the new plots data</a></li>
<li><a href="#joining-the-new-data">Joining the new data</a></li>
<li><a href="#adding-to-the-old-data">Adding to the old data</a></li>
<li><a href="#final-outputs">Final outputs</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="05-extra-challenges.html">6. Extra Challenges</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="aio.html">See all in one page</a>

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="03-working-with-data.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="05-extra-challenges.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="03-working-with-data.html" rel="prev"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous: Working with data</a>
        <a class="chapter-link float-end" href="05-extra-challenges.html" rel="next">Next: Extra Challenges... <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Putting it together</h1>
        <p> Last updated on 2022-07-26 | <a href="https://github.com/MCMaurer/Rewrite-R-ecology-lesson/edit/main/episodes/04-putting-it-together.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        
<!-- - read in new surveys data --><!-- - EDA --><!--     - str() --><!--     - summary() --><!--     - maybe a quick plot or two --><!--     - you can pipe into ggplot() --><!-- - explore, find errors --><!-- - show how to change 9999 to NA --><!--   - if_else() --><!--   - replace_na() --><!-- - show how to find errant characters --><!-- - show how to remove errant characters and change to numeric --><!-- - make date column, find bad dates --><!-- - pivot_longer on plots data --><!-- - separate on species data --><!-- - joins --><!-- - bind_rows to old data -->
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How do you apply data manipulation skills to multiple new files?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Read in messy data and find issues.</li>
<li>Replace incorrect values.</li>
<li>Read data from multiple file formats.</li>
<li>Utilize <code>pivot_</code> functions to reshape untidy data.</li>
<li>Combine multiple datasets.</li>
<li>Understand the process of formatting new data similarly to existing data.</li>
</ul></div>
</div>
</div>
</div>
</div>

<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<p>So far we have been working with surveys data from 1977 to 1989, and our data have been pretty neat and tidy. There are some <code>NA</code> values, but for the most part, the data have been formatted nicely. However, as many of us know, we do not always receive data in such nice shape. It’s pretty common to get data with all sorts of formatting issues, maybe some strange file formats, and possibly spread across several different sources.</p>
<p>Well, it turns out we have just that situation! We have received a newer batch of surveys data, from 1990 to 2002, and we want to add it to our older dataset so we can work with them together. Unfortunately, the data are not formatted quite as nicely as our old data. Our collaborators have told us to “look them over” for any errors, but have not given us very much specific information. We will have to explore the new data to make sure we understand it and verify that there aren’t any errors.</p>
<p>You can download a <code>.zip</code> file containing three new data files here: <a href="https://www.michaelc-m.com/Rewrite-R-ecology-lesson/data/new_data.zip" class="external-link uri">https://www.michaelc-m.com/Rewrite-R-ecology-lesson/data/new_data.zip</a>. When prompted, save the file to your <code>data/raw/</code> folder. A <code>.zip</code> file is a type of compressed file that contains one or more files or directories. We will use the <code>unzip()</code> command to extract the data files from the <code>.zip</code> file. The first argument is the path to the <code>.zip</code> file, the next argument is the directory we want to put the extracted files into, and the last argument tells <code>unzip()</code> to not create an additional directory for the new files. Since this is an action we only want to perform once, we will run it directly in the <strong>Console</strong> instead of putting it into a script.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">unzip</span><span class="op">(</span><span class="st">"data/raw/new_data.zip"</span>, exdir <span class="op">=</span> <span class="st">"data/raw/"</span>, junkpaths <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning in unzip("data/raw/new_data.zip", exdir = "data/raw/", junkpaths =
TRUE): error 1 in extracting from zip file</code></pre>
</div>
<p>Use the <strong>Files</strong> pane in the lower right to navigate to the <code>data/raw/</code> folder and you should find 3 new files: <code>plots_new.csv</code>, <code>species_new.txt</code>, and <code>surveys_new.csv</code>.</p>
<section id="reading-the-new-surveys-data"><h2 class="section-heading">Reading the new surveys data</h2>
<hr class="half-width"><p>Let’s start off with the new surveys data. First we will read it into R:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_new</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/raw/surveys_new.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: One or more parsing issues, see `problems()` for details</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rows: 18676 Columns: 7
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): date (mm/dd/yyyy), species_id, sex
dbl (4): record_id, plot_id, hindfoot_length, weight

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<p>You will notice it contains a lot of columns from our previous <code>surveys</code> data, but not all of the columns. Some of them are only found in our other <code>plots_new.csv</code> and <code>species_new.txt</code> files.</p>
<p>First thing we want to do with <code>surveys_new</code> is fix that <code>date</code> column name with spaces in it. R can handle them, but they are often very annoying. We can use the <code>rename()</code> function to change the column name.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_new</span> <span class="op">&lt;-</span> <span class="va">surveys_new</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">rename</span><span class="op">(</span>date <span class="op">=</span> <span class="va">`date (mm/dd/yyyy)`</span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s take a look at a summary of our data using <code>summary()</code>.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">surveys_new</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   record_id         date              plot_id       species_id       
 Min.   :16879   Length:18676       Min.   : 1.00   Length:18676      
 1st Qu.:21545   Class :character   1st Qu.: 5.00   Class :character  
 Median :26214   Mode  :character   Median :12.00   Mode  :character  
 Mean   :26214                      Mean   :11.33                     
 3rd Qu.:30881                      3rd Qu.:17.00                     
 Max.   :35549                      Max.   :24.00                     
                                                                      
     sex            hindfoot_length     weight      
 Length:18676       Min.   : 2.00   Min.   :   4.0  
 Class :character   1st Qu.:21.00   1st Qu.:  19.0  
 Mode  :character   Median :26.00   Median :  32.0  
                    Mean   :27.08   Mean   : 873.7  
                    3rd Qu.:36.00   3rd Qu.:  47.0  
                    Max.   :64.00   Max.   :9999.0  
                    NA's   :1380                    </code></pre>
</div>
<p>The <code>summary()</code> function is often useful for detecting outliers or clearly incorrect values, since we get a <code>Min.</code> and <code>Max.</code> value for each numeric column. For example, we see that <code>month</code> goes from 1 to 12 and <code>day</code> goes from 1 to 31, so no issues there. However, we do notice that <code>weight</code> has a max value of 9999. Sometimes people will use extreme and impossible values to denote a missing value. It is worth checking with our collaborators to make sure this is the case, but we will assume that’s what happened.</p>
<p>Finally, we actually got a warning message about a <strong>parsing</strong> issue. This message actually comes from <code>read_csv()</code>, even though it only showed up now. <strong>Parsing</strong> is what <code>read_csv()</code> does when it tries to guess what type of vector each CSV column should be. Sometimes it will warn us about issues that occurred, which we can then investigate with the <code>problems()</code> function.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">problems</span><span class="op">(</span><span class="va">surveys_new</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 5
    row   col expected actual file                                              
  &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;                                             
1    19     6 a double 19'    /home/runner/work/Rewrite-R-ecology-lesson/Rewrit…</code></pre>
</div>
<p>The output shows that in the 19th row and 8th column of the CSV, <code>read_csv()</code> expected a double, or numeric, value. Instead, what it got was <code>19'</code>. That stray quotation mark was unexpected, so <code>read_csv()</code> notified us. Let’s go see what value is actually there for <code>surveys_new</code>. It was in the 19th row of the CSV, which includes the header row containing column names, so we should look at the 18th row of our data.frame. The 8th column is <code>hindfoot_length</code>. We can use the <code>head()</code> function to look at the first 20 rows.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_new</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">head</span><span class="op">(</span>n<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 20 × 7
   record_id date     plot_id species_id sex   hindfoot_length weight
       &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
 1     16879 1/6/1990       1 DM         F                  37     35
 2     16880 1/6/1990       1 OL         M                  21     28
 3     16881 1/6/1990       6 PF         M                  16      7
 4     16882 1/6/1990      23 RM         F                  17      9
 5     16883 1/6/1990      12 RM         M                  17     10
 6     16884 1/6/1990      24 RM         M                  17      9
 7     16885 1/6/1990      12 SF         M                  25     35
 8     16886 1/6/1990      24 SH         F                  30     73
 9     16887 1/6/1990      12 SF         M                  28     44
10     16888 1/6/1990      17 DO         M                  36     55
11     16889 1/6/1990      21 SF         M                  29     55
12     16890 1/6/1990      12 OT         M                  22     23
13     16891 1/6/1990      12 DO         F                  36     53
14     16892 1/6/1990      21 AB         &lt;NA&gt;               NA   9999
15     16893 1/6/1990      12 OT         F                  21     24
16     16894 1/6/1990       1 OT         F                  21     20
17     16895 1/6/1990      12 SF         F                  27     75
18     16896 1/6/1990      12 RM         M                  NA     11
19     16897 1/6/1990      21 SF         F                  29     46
20     16898 1/6/1990      23 RM         M                  18     11</code></pre>
</div>
<p>Because <code>read_csv()</code> didn’t know what to do with the value <code>19'</code>, there is an <code>NA</code> for <code>hindfoot_length</code> in row 18. It is likely that the true value was <code>19</code> and the stray quotation mark was simply a typo. If we want to change that value, we can do it by referring to the <code>record_id</code>, since it is a unique identifier for each row. We will use the function <code>if_else()</code> to actually replace the value. This function takes a logical statement as its first argument, then a value to return if that statement is <code>TRUE</code>, and a value to return if it is <code>FALSE</code>. Take a look at this example:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="fu">ifelse</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">6</span>, <span class="st">"bigger than 6"</span>, <span class="st">"not bigger than 6"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] "not bigger than 6" "not bigger than 6" "not bigger than 6"
 [4] "not bigger than 6" "not bigger than 6" "not bigger than 6"
 [7] "bigger than 6"     "bigger than 6"     "bigger than 6"    
[10] "bigger than 6"    </code></pre>
</div>
<p>What we will do is take <code>surveys_new</code> and mutate the <code>hindfoot_length</code> column. It will be equal to the result of an <code>ifelse()</code> statement. If the <code>record_id</code> is <code>16896</code>, the row we are trying to change, then <code>hindfoot_length</code> will be set to 19. If the <code>record_id</code> is not <code>16896</code>, then it will stay as the current <code>hindfoot_length</code> value.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_new</span> <span class="op">&lt;-</span> <span class="va">surveys_new</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>hindfoot_length <span class="op">=</span> <span class="fu">ifelse</span><span class="op">(</span><span class="va">record_id</span> <span class="op">==</span> <span class="fl">16896</span>, <span class="fl">19</span>, <span class="va">hindfoot_length</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">surveys_new</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">head</span><span class="op">(</span>n<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 20 × 7
   record_id date     plot_id species_id sex   hindfoot_length weight
       &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
 1     16879 1/6/1990       1 DM         F                  37     35
 2     16880 1/6/1990       1 OL         M                  21     28
 3     16881 1/6/1990       6 PF         M                  16      7
 4     16882 1/6/1990      23 RM         F                  17      9
 5     16883 1/6/1990      12 RM         M                  17     10
 6     16884 1/6/1990      24 RM         M                  17      9
 7     16885 1/6/1990      12 SF         M                  25     35
 8     16886 1/6/1990      24 SH         F                  30     73
 9     16887 1/6/1990      12 SF         M                  28     44
10     16888 1/6/1990      17 DO         M                  36     55
11     16889 1/6/1990      21 SF         M                  29     55
12     16890 1/6/1990      12 OT         M                  22     23
13     16891 1/6/1990      12 DO         F                  36     53
14     16892 1/6/1990      21 AB         &lt;NA&gt;               NA   9999
15     16893 1/6/1990      12 OT         F                  21     24
16     16894 1/6/1990       1 OT         F                  21     20
17     16895 1/6/1990      12 SF         F                  27     75
18     16896 1/6/1990      12 RM         M                  19     11
19     16897 1/6/1990      21 SF         F                  29     46
20     16898 1/6/1990      23 RM         M                  18     11</code></pre>
</div>
<p>We can actually use <code>ifelse()</code> to fix the values of <code>9999</code> in the <code>weight</code> column as well.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_new</span> <span class="op">&lt;-</span> <span class="va">surveys_new</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>weight <span class="op">=</span> <span class="fu">ifelse</span><span class="op">(</span><span class="va">weight</span> <span class="op">==</span> <span class="fl">9999</span>, <span class="cn">NA</span>, <span class="va">weight</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surveys_new</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">head</span><span class="op">(</span>n<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 20 × 7
   record_id date     plot_id species_id sex   hindfoot_length weight
       &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
 1     16879 1/6/1990       1 DM         F                  37     35
 2     16880 1/6/1990       1 OL         M                  21     28
 3     16881 1/6/1990       6 PF         M                  16      7
 4     16882 1/6/1990      23 RM         F                  17      9
 5     16883 1/6/1990      12 RM         M                  17     10
 6     16884 1/6/1990      24 RM         M                  17      9
 7     16885 1/6/1990      12 SF         M                  25     35
 8     16886 1/6/1990      24 SH         F                  30     73
 9     16887 1/6/1990      12 SF         M                  28     44
10     16888 1/6/1990      17 DO         M                  36     55
11     16889 1/6/1990      21 SF         M                  29     55
12     16890 1/6/1990      12 OT         M                  22     23
13     16891 1/6/1990      12 DO         F                  36     53
14     16892 1/6/1990      21 AB         &lt;NA&gt;               NA     NA
15     16893 1/6/1990      12 OT         F                  21     24
16     16894 1/6/1990       1 OT         F                  21     20
17     16895 1/6/1990      12 SF         F                  27     75
18     16896 1/6/1990      12 RM         M                  19     11
19     16897 1/6/1990      21 SF         F                  29     46
20     16898 1/6/1990      23 RM         M                  18     11</code></pre>
</div>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-find-a-specialized-function" class="callout-inner">
<h3 class="callout-title">Challenge 1: Find a specialized function</h3>
<div class="callout-content">
<p>The <code>tidyverse</code> often has specialized functions for common data manipulation tasks, such as replacing a certain values with <code>NA</code>. There is a <code>tidyverse</code> function to replace a value in a vector with <code>NA</code>. Put your Googling skills to work and see if you can find the correct function.</p>
<p>For an extra challenge, write out code that could use this function to replace <code>weight</code> values of 9999 with <code>NA</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>The <code>dplyr</code> function <code>na_if()</code> will replace specific values in a vector to <code>NA</code>. To find this function, you can Google “tidyverse replace value with NA”. One of the first results is the <a href="https://dplyr.tidyverse.org/reference/na_if.html" class="external-link"><code>dplyr</code> documentation page</a> for the <code>na_if()</code> function.</p>
<p>If you scroll down to the bottom section of the documentation, you will find several examples, including how to use the function inside <code>mutate()</code>.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_new</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>weight <span class="op">=</span> <span class="fu">na_if</span><span class="op">(</span><span class="va">weight</span>, <span class="fl">9999</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The last thing we have to do is deal with our date column. It’s currently a character column, but our old <code>surveys</code> data had separate columns for <code>year</code>, <code>month</code>, and <code>day</code>. Another thing we should do is check for any errors in our dates, since they are an error-prone data type.</p>
<p>There are a few ways we could approach this problem, which is a common theme in R: there are often many ways to accomplish the same task. It is often useful to plan your approach ahead of time, so we will describe two possible methods:</p>
<ol style="list-style-type: decimal"><li><p>Turn the current column into a date column, validate the dates, then use <code>lubridate</code> functions to extract the year, month, and day into their own columns.</p></li>
<li><p>Use the <code>separate()</code> function to split our current date column into 3 new character columns, containing the month, day and year. Then turn those columns into numeric columns. Then it will match our old <code>surveys</code> data, and we can later make a date column to validate our dates.</p></li>
</ol><p>It is often useful to plan out your approach, or several approaches, before you start writing code. It can be in the form of plain English like above, or in <strong>“pseudo-code”</strong>, which is laid out like code, but doesn’t have explicit, functioning code.</p>
<p>We will go ahead and use the first approach. First we will load <code>lubridate</code> and use the <code>mdy()</code> function to turn our <code>date</code> column into a date instead of character column.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">lubridate</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Attaching package: 'lubridate'</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>The following objects are masked from 'package:base':

    date, intersect, setdiff, union</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_new</span> <span class="op">&lt;-</span> <span class="va">surveys_new</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">mdy</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: 6 failed to parse.</code></pre>
</div>
<p>We got a warning message about 6 dates failing to parse. This means that the <code>mdy()</code> function encountered 6 dates that it wasn’t able to identify correctly. When <code>lubridate</code> functions fail to parse dates, they will return an <code>NA</code> value instead. To find the rows where this happened, we can use <code>filter()</code>:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_new</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="fu">is.na</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 7
  record_id date   plot_id species_id sex   hindfoot_length weight
      &lt;dbl&gt; &lt;date&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
1     22258 NA           8 AH         &lt;NA&gt;               NA     NA
2     22261 NA           9 DM         F                  37     45
3     30595 NA          18 PB         F                  25     34
4     30610 NA           2 PB         F                  25     31
5     30638 NA          20 PP         F                  22     20
6     31394 NA          12 OT         F                  20     29</code></pre>
</div>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2-find-the-bad-dates" class="callout-inner">
<h3 class="callout-title">Challenge 2: Find the bad dates</h3>
<div class="callout-content">
<p>We have now located the rows with <code>NA</code> dates, but we probably want to know what the original date character strings looked like. Figure out what those dates were and why they might have been wrong.</p>
<p><strong>Hint</strong>: you will have to look at a previous version of the data, before we modified the <code>date</code> column.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>There are two basic approaches you could take. First, you could look directly at the old CSV and find the rows with bad dates based on their <code>record_id</code>.</p>
<p>You could also read the data back into R and use <code>filter()</code> to pick out those specific rows via <code>record_id</code>:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/raw/surveys_new.csv"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">record_id</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="fl">22258</span>, <span class="fl">22261</span>, <span class="fl">30595</span>, <span class="fl">30610</span>, <span class="fl">30638</span>, <span class="fl">31394</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: One or more parsing issues, see `problems()` for details</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 7
  record_id `date (mm/dd/yyyy)` plot_id species_id sex   hindfoot_length weight
      &lt;dbl&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
1     22258 4/31/1995                 8 AH         &lt;NA&gt;               NA   9999
2     22261 4/31/1995                 9 DM         F                  37     45
3     30595 4/31/2000                18 PB         F                  25     34
4     30610 4/31/2000                 2 PB         F                  25     31
5     30638 4/31/2000                20 PP         F                  22     20
6     31394 9/31/2000                12 OT         F                  20     29</code></pre>
</div>
<p>The dates are wrong because they are the 31st day in a month that only has 30 days, like April or September. <code>lubridate</code> doesn’t recognize these as valid dates. The same thing can happen with things like dates in February during non-leap years.</p>
</div>
</div>
</div>
</div>
<p>The last thing to do is extract the year, month, and day values from our <code>date</code> column. <code>lubridate</code> has functions to extract each component of a date. We will then get rid of the <code>date</code> column, since it doesn’t appear in our original <code>surveys</code> data, and we can always remake it from the component columns.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_new</span> <span class="op">&lt;-</span> <span class="va">surveys_new</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span>,</span>
<span>         month <span class="op">=</span> <span class="fu">month</span><span class="op">(</span><span class="va">date</span><span class="op">)</span>,</span>
<span>         day <span class="op">=</span> <span class="fu">day</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surveys_new</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 18,676 × 9
   record_id plot_id species_id sex   hindfoot_length weight  year month   day
       &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
 1     16879       1 DM         F                  37     35  1990     1     6
 2     16880       1 OL         M                  21     28  1990     1     6
 3     16881       6 PF         M                  16      7  1990     1     6
 4     16882      23 RM         F                  17      9  1990     1     6
 5     16883      12 RM         M                  17     10  1990     1     6
 6     16884      24 RM         M                  17      9  1990     1     6
 7     16885      12 SF         M                  25     35  1990     1     6
 8     16886      24 SH         F                  30     73  1990     1     6
 9     16887      12 SF         M                  28     44  1990     1     6
10     16888      17 DO         M                  36     55  1990     1     6
# … with 18,666 more rows</code></pre>
</div>
<!-- ::::::::::::::::::::::::::::::::::::: challenge  -->
<!-- ## Optional challenge: Try the other method -->
<!-- :::::::::::::::::::::::: solution  -->
<!-- ```{r na-if-challenge-answer} -->
<!-- read_csv("data/raw/surveys_new.csv") %>%  -->
<!--   rename(date = `date (mm/dd/yyyy)`) %>%  -->
<!--   separate(date, into = c("month", "day", "year"), sep = "/") %>%  -->
<!--   mutate(across(c(month, day, year), as.numeric)) %>%  -->
<!--   mutate(date = paste(year, month, day) %>%  -->
<!--            lubridate::ymd()) -->
<!-- ``` -->
<!-- :::::::::::::::::::::::: -->
<!-- :::::::::::::::::::::::::::::::::::::::::::::::: -->
</section><section id="reading-the-new-species-data"><h2 class="section-heading">Reading the new species data</h2>
<hr class="half-width"><p>Our <code>surveys_new</code> data look good at this point, so let’s move on to the species data. You may have noticed that our species data came in a different file format, <code>species_new.txt</code>. So far we have been working with CSV files, in which values are separated by commas. However, R is capable of reading many different file types. The <code>.txt</code> extension means it is a plain-text file, which means the data could be formatted in quite a few different ways. Let’s take a look at the file directly to see how it is structured.</p>
<p>Click on the <code>species_new.txt</code> file in the <strong>Files</strong> pane to open it in RStudio. We see that our data are still structured in columns and rows, with column names in the header row. Each value is wrapped in quotes, values are separated by spaces, and each row ends with a new line.</p>
<p>This is a generic data structure called “delimited” data. A CSV is a form of delimited data, where values are “delimited”, or separated, by commas. Luckily, the <code>readr</code> package has a function for dealing with more generic delimited data, called <code>read_delim()</code>.</p>
<p>We have to give <code>read_delim()</code> three arguments. First is the file path, just like <code>read_csv()</code>. The second argument is what character string is used to delimit each item in the file. In our case, it is a space, so we make a character string that is just a space. Finally, we need to identify what is used to quote each entry in our file. Our values are wrapped in double-quotes, so we need to type a double quote. However, we can’t just type 3 double-quotes, or R will get upset with us (give it a try if you want). Luckily, R recognizes both single- and double-quotes for creating character strings. So we can use single-quotes to make our character string, and put one double-quote character inside it.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">species_new</span> <span class="op">&lt;-</span> <span class="fu">read_delim</span><span class="op">(</span><span class="st">"data/raw/species_new.txt"</span>, delim <span class="op">=</span> <span class="st">" "</span>, quote <span class="op">=</span> <span class="st">'"'</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rows: 54 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: " "
chr (3): species_id, species_name, taxa

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">species_new</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 54 × 3
   species_id species_name                    taxa   
   &lt;chr&gt;      &lt;chr&gt;                           &lt;chr&gt;  
 1 AB         Amphispiza bilineata            Bird   
 2 AH         Ammospermophilus harrisi        Rodent 
 3 AS         Ammodramus savannarum           Bird   
 4 BA         Baiomys taylori                 Rodent 
 5 CB         Campylorhynchus brunneicapillus Bird   
 6 CM         Calamospiza melanocorys         Bird   
 7 CQ         Callipepla squamata             Bird   
 8 CS         Crotalus scutalatus             Reptile
 9 CT         Cnemidophorus tigris            Reptile
10 CU         Cnemidophorus uniparens         Reptile
# … with 44 more rows</code></pre>
</div>
<p>What we get back is a tibble, formatted just like it would have been if our data were in a CSV.</p>
<p>One thing we might notice is that our species and genus are combined into one column called <code>species_name</code>, whereas in our old data, we had separate columns for <code>genus</code> and <code>species</code>. It is fairly common to have data in one column that could be separated into two or more columns. Luckily, <code>tidyr</code> has a convenient function for solving this problem, called <code>separate()</code>.</p>
<p>We pipe <code>species_new</code> into the <code>separate()</code> function, then give it several other arguments. First, the name of the column to be separated, <code>species_name</code>. Next, we give the argument <code>into</code> a character vector of the new columns we want. Finally, we give a string for what is currently separating each of the new values in the current column. In <code>species_name</code>, the genus and species are separated by a space.</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">species_new</span> <span class="op">&lt;-</span> <span class="va">species_new</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">separate</span><span class="op">(</span><span class="va">species_name</span>, into <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"genus"</span>, <span class="st">"species"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span>
<span></span>
<span><span class="va">species_new</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 54 × 4
   species_id genus            species         taxa   
   &lt;chr&gt;      &lt;chr&gt;            &lt;chr&gt;           &lt;chr&gt;  
 1 AB         Amphispiza       bilineata       Bird   
 2 AH         Ammospermophilus harrisi         Rodent 
 3 AS         Ammodramus       savannarum      Bird   
 4 BA         Baiomys          taylori         Rodent 
 5 CB         Campylorhynchus  brunneicapillus Bird   
 6 CM         Calamospiza      melanocorys     Bird   
 7 CQ         Callipepla       squamata        Bird   
 8 CS         Crotalus         scutalatus      Reptile
 9 CT         Cnemidophorus    tigris          Reptile
10 CU         Cnemidophorus    uniparens       Reptile
# … with 44 more rows</code></pre>
</div>
<p>There we go, now <code>species_new</code> is formatted like the similar columns in the older <code>surveys</code> data.</p>
<p><br></p>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Convert column types when separating
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>The <code>separate()</code> function also has an argument called <code>convert</code>, which will automatically convert the types of your new columns. For example, if you had a column called <code>range</code> that had character strings like <code>"1990-1995"</code>, and you wanted to separate it into <code>start</code> and <code>end</code> columns, you would end up with character columns if you used <code>separate()</code> like we did above. However, if you use <code>convert = T</code>, the new columns will be converted to integers. Check out this short example below:</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>years <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"1990-1995"</span>, <span class="st">"2000-2002"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">d</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">separate</span><span class="op">(</span><span class="va">years</span>, into <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"start"</span>, <span class="st">"end"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 2 × 2
  start end  
  &lt;chr&gt; &lt;chr&gt;
1 1990  1995 
2 2000  2002 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">separate</span><span class="op">(</span><span class="va">years</span>, into <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"start"</span>, <span class="st">"end"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"-"</span>, convert <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 2 × 2
  start   end
  &lt;int&gt; &lt;int&gt;
1  1990  1995
2  2000  2002</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="reading-the-new-plots-data"><h2 class="section-heading">Reading the new plots data</h2>
<hr class="half-width"><p>Finally, we can move on to the new <code>plots</code> data, in the <code>plots_new.csv</code> file. We can go back to <code>read_csv()</code> to get it into R.</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots_new</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/raw/plots_new.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rows: 1 Columns: 24
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (24): Plot 1, Plot 2, Plot 3, Plot 4, Plot 5, Plot 6, Plot 7, Plot 8, Pl...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots_new</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 24
  `Plot 1`        `Plot 2` `Plot 3` `Plot 4` `Plot 5` `Plot 6` `Plot 7` `Plot 8`
  &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   
1 Spectab exclos… Control  Long-te… Control  Rodent … Short-t… Rodent … Control 
# … with 16 more variables: `Plot 9` &lt;chr&gt;, `Plot 10` &lt;chr&gt;, `Plot 11` &lt;chr&gt;,
#   `Plot 12` &lt;chr&gt;, `Plot 13` &lt;chr&gt;, `Plot 14` &lt;chr&gt;, `Plot 15` &lt;chr&gt;,
#   `Plot 16` &lt;chr&gt;, `Plot 17` &lt;chr&gt;, `Plot 18` &lt;chr&gt;, `Plot 19` &lt;chr&gt;,
#   `Plot 20` &lt;chr&gt;, `Plot 21` &lt;chr&gt;, `Plot 22` &lt;chr&gt;, `Plot 23` &lt;chr&gt;,
#   `Plot 24` &lt;chr&gt;</code></pre>
</div>
<p>It looks like our data are in a bit of a strange format. We have a column for each plot, and then a single row of data containing the plot type. If you look at our old <code>surveys</code> data, we had a single row for <code>plot_id</code> and a single row for <code>plot_type</code>. <code>surveys</code> contained this data in a <strong>long</strong> format, whereas <code>plots_new</code> has a <strong>wide</strong> format.</p>

<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3-reshape-plots_new" class="callout-inner">
<h3 class="callout-title">Challenge 3: Reshape <code>plots_new</code>
</h3>
<div class="callout-content">
<p>Take the <code>plots_new</code> data.frame and shape it into a long format. You should end up with two columns: <code>plot_id</code> containing the ID for each plot, and <code>plot_type</code> containing the type for each plot.</p>
<p><strong>Hint</strong>: the function <code>everything()</code> means “every column” when selecting columns.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots_new</span> <span class="op">&lt;-</span> <span class="va">plots_new</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"plot_id"</span>, values_to <span class="op">=</span> <span class="st">"plot_type"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plots_new</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 24 × 2
   plot_id plot_type                
   &lt;chr&gt;   &lt;chr&gt;                    
 1 Plot 1  Spectab exclosure        
 2 Plot 2  Control                  
 3 Plot 3  Long-term Krat Exclosure 
 4 Plot 4  Control                  
 5 Plot 5  Rodent Exclosure         
 6 Plot 6  Short-term Krat Exclosure
 7 Plot 7  Rodent Exclosure         
 8 Plot 8  Control                  
 9 Plot 9  Spectab exclosure        
10 Plot 10 Rodent Exclosure         
# … with 14 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Our old <code>surveys</code> data had <code>plot_id</code> as a numeric variable, but ours is a character string with <code>"Plot "</code> in front of the number. This is a pretty common issue, but we can use a function from the <code>stringr</code> package to fix it.</p>
<p>We will use <code>mutate()</code> to modify the <code>plot_id</code> column, and we will replace it with the results of the <code>str_replace()</code> function. The first argument to <code>str_replace()</code> is the character vector we want to modify, which is the current <code>plot_id</code> column. Next is the string of characters that we want to replace, which is <code>"Plot "</code>, including the space at the end. Finally, we have the replacement string. Since we want to remove <code>"Plot "</code>, we replace it with a blank string <code>""</code>.</p>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots_new</span> <span class="op">&lt;-</span> <span class="va">plots_new</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>plot_id <span class="op">=</span> <span class="fu">str_replace</span><span class="op">(</span><span class="va">plot_id</span>, <span class="st">"Plot "</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plots_new</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 24 × 2
   plot_id plot_type                
   &lt;chr&gt;   &lt;chr&gt;                    
 1 1       Spectab exclosure        
 2 2       Control                  
 3 3       Long-term Krat Exclosure 
 4 4       Control                  
 5 5       Rodent Exclosure         
 6 6       Short-term Krat Exclosure
 7 7       Rodent Exclosure         
 8 8       Control                  
 9 9       Spectab exclosure        
10 10      Rodent Exclosure         
# … with 14 more rows</code></pre>
</div>
<p>We successfully removed <code>"Plot "</code> from our <code>plot_id</code> column entries, so we are left with just the numbers. However, it is still a <code>character</code> column. The last step is to convert it to a numeric column.</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots_new</span> <span class="op">&lt;-</span> <span class="va">plots_new</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>plot_id <span class="op">=</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">plot_id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plots_new</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 24 × 2
   plot_id plot_type                
     &lt;dbl&gt; &lt;chr&gt;                    
 1       1 Spectab exclosure        
 2       2 Control                  
 3       3 Long-term Krat Exclosure 
 4       4 Control                  
 5       5 Rodent Exclosure         
 6       6 Short-term Krat Exclosure
 7       7 Rodent Exclosure         
 8       8 Control                  
 9       9 Spectab exclosure        
10      10 Rodent Exclosure         
# … with 14 more rows</code></pre>
</div>
</section><section id="joining-the-new-data"><h2 class="section-heading">Joining the new data</h2>
<hr class="half-width"><p>Now that we have each individual data.frame formatted nicely, we would like to be able to combine them. Our <code>surveys</code> data has all of the data combined into one data.frame. However, our data.frames are different sizes. <code>surveys_new</code> has 18676 rows, and it contains the individual data for each animal. This is the same basic size of the old <code>surveys</code> data. However, our <code>plots_new</code> and <code>species_new</code> data are much smaller. They only contain data on specific plots and species.</p>
<p>If we look at the column names for <code>surveys_new</code> and <code>plots_new</code>, we see that they share a <code>plot_id</code> column. What we want to do now is take the data of our actual observations, <code>surveys_new</code>, and add the data for each associated plot. If a row in <code>surveys_new</code> has a <code>plot_id</code> of 2, we want to associate the <code>plot_type</code> of that plot with that row. We can accomplish this using a <strong>join</strong>.</p>
<figure><img src="fig/left_join.png" alt="Diagram depicting the behavior of a `left_join()` on two small tabular datasets." class="figure mx-auto d-block"></figure><p>There are several types of joins in the <code>dplyr</code> package, which you can <a href="https://stat545.com/join-cheatsheet.html" class="external-link">read more about here</a>. We will use a function called <code>left_join()</code>, which takes two dataframes and adds the columns from the second dataframe to the first dataframe, matching rows based on the column name supplied to the <code>by</code> argument.</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">left_join</span><span class="op">(</span><span class="va">surveys_new</span>, <span class="va">plots_new</span>, by <span class="op">=</span> <span class="st">"plot_id"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 18,676 × 10
   record_id plot_id species_id sex   hindfoot_length weight  year month   day
       &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
 1     16879       1 DM         F                  37     35  1990     1     6
 2     16880       1 OL         M                  21     28  1990     1     6
 3     16881       6 PF         M                  16      7  1990     1     6
 4     16882      23 RM         F                  17      9  1990     1     6
 5     16883      12 RM         M                  17     10  1990     1     6
 6     16884      24 RM         M                  17      9  1990     1     6
 7     16885      12 SF         M                  25     35  1990     1     6
 8     16886      24 SH         F                  30     73  1990     1     6
 9     16887      12 SF         M                  28     44  1990     1     6
10     16888      17 DO         M                  36     55  1990     1     6
# … with 18,666 more rows, and 1 more variable: plot_type &lt;chr&gt;</code></pre>
</div>
<p>Now we have our <code>surveys_new</code> dataframe, still with 18676 rows, but now each row has a value for <code>plot_type</code>, corresponding to its entry in <code>plot_id</code>. We can assign this back to <code>surveys_new</code>, so that it now contains the information from both dataframes.</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_new</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">surveys_new</span>, <span class="va">plots_new</span>, by <span class="op">=</span> <span class="st">"plot_id"</span><span class="op">)</span></span></code></pre>
</div>
<p>We can repeat this process to get the information from <code>species_new</code>. <code>surveys_new</code> and <code>species_new</code> both have a <code>species_id</code> column, but we would like to add the <code>genus</code>, <code>species</code>, and <code>taxa</code> information to <code>surveys_new</code>.</p>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_new</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">surveys_new</span>, <span class="va">species_new</span>, by <span class="op">=</span> <span class="st">"species_id"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surveys_new</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 18,676 × 13
   record_id plot_id species_id sex   hindfoot_length weight  year month   day
       &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
 1     16879       1 DM         F                  37     35  1990     1     6
 2     16880       1 OL         M                  21     28  1990     1     6
 3     16881       6 PF         M                  16      7  1990     1     6
 4     16882      23 RM         F                  17      9  1990     1     6
 5     16883      12 RM         M                  17     10  1990     1     6
 6     16884      24 RM         M                  17      9  1990     1     6
 7     16885      12 SF         M                  25     35  1990     1     6
 8     16886      24 SH         F                  30     73  1990     1     6
 9     16887      12 SF         M                  28     44  1990     1     6
10     16888      17 DO         M                  36     55  1990     1     6
# … with 18,666 more rows, and 4 more variables: plot_type &lt;chr&gt;, genus &lt;chr&gt;,
#   species &lt;chr&gt;, taxa &lt;chr&gt;</code></pre>
</div>
<p>Now our <code>surveys_new</code> dataframe has all the information from our 3 files, and the same number of columns as our original <code>surveys</code> data.</p>
</section><section id="adding-to-the-old-data"><h2 class="section-heading">Adding to the old data</h2>
<hr class="half-width"><p>Now that our old <code>surveys</code> data and <code>surveys_new</code> data are formatted in the same way, we can bind them together so we have data from all years in one data.frame. First let’s read our `surveys’ data back in.</p>
<div class="codewrapper sourceCode" id="cb58">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/cleaned/surveys_complete_77_89.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rows: 16878 Columns: 13
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (6): species_id, sex, genus, species, taxa, plot_type
dbl (7): record_id, month, day, year, plot_id, hindfoot_length, weight

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<p>Now we can use the <code>bind_rows()</code> function to bind the rows of our two data.frames together. The fact that our columns are not in the same order doesn’t matter, <code>bind_rows()</code> will detect thatt the column names are the same, and will rearrange them to match the first data.frame.</p>
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_complete</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">surveys</span>, <span class="va">surveys_new</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surveys_complete</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 35,554 × 13
   record_id month   day  year plot_id species_id sex   hindfoot_length weight
       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
 1         1     7    16  1977       2 NL         M                  32     NA
 2         2     7    16  1977       3 NL         M                  33     NA
 3         3     7    16  1977       2 DM         F                  37     NA
 4         4     7    16  1977       7 DM         M                  36     NA
 5         5     7    16  1977       3 DM         M                  35     NA
 6         6     7    16  1977       1 PF         M                  14     NA
 7         7     7    16  1977       2 PE         F                  NA     NA
 8         8     7    16  1977       1 DM         M                  37     NA
 9         9     7    16  1977       1 DM         F                  34     NA
10        10     7    16  1977       6 PF         F                  20     NA
# … with 35,544 more rows, and 4 more variables: genus &lt;chr&gt;, species &lt;chr&gt;,
#   taxa &lt;chr&gt;, plot_type &lt;chr&gt;</code></pre>
</div>
<p>We might be interested in indicating which rows of our data came from which source: the old data or the new. We can name the data.frames inside <code>bind_rows()</code>, and then give a new argument <code>.id</code>. This will give us a new column called <code>source</code> that contains a value of <code>"old"</code> for rows that came from <code>surveys</code>, and a value of <code>"new"</code> for rows that came from <code>surveys_new</code>.</p>
<div class="codewrapper sourceCode" id="cb62">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_complete</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span>old <span class="op">=</span> <span class="va">surveys</span>, new <span class="op">=</span> <span class="va">surveys_new</span>, .id <span class="op">=</span> <span class="st">"source"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surveys_complete</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 35,554 × 14
   source record_id month   day  year plot_id species_id sex   hindfoot_length
   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;
 1 old            1     7    16  1977       2 NL         M                  32
 2 old            2     7    16  1977       3 NL         M                  33
 3 old            3     7    16  1977       2 DM         F                  37
 4 old            4     7    16  1977       7 DM         M                  36
 5 old            5     7    16  1977       3 DM         M                  35
 6 old            6     7    16  1977       1 PF         M                  14
 7 old            7     7    16  1977       2 PE         F                  NA
 8 old            8     7    16  1977       1 DM         M                  37
 9 old            9     7    16  1977       1 DM         F                  34
10 old           10     7    16  1977       6 PF         F                  20
# … with 35,544 more rows, and 5 more variables: weight &lt;dbl&gt;, genus &lt;chr&gt;,
#   species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;</code></pre>
</div>
<p>We have now successfully cleaned our new data and reshaped it to match our old data so they could be arranged into one data.frame covering all the years.</p>
</section><section id="final-outputs"><h2 class="section-heading">Final outputs</h2>
<hr class="half-width"><p>Let’s go ahead and write our data to a CSV file so we can share it with others.</p>
<div class="codewrapper sourceCode" id="cb64">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_complete</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">write_csv</span><span class="op">(</span><span class="st">"data/cleaned/surveys_complete.csv"</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we might be interested in looking at all of our data together. Try making some plots of your own to look at the whole dataset!</p>
<div class="codewrapper sourceCode" id="cb65">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_complete</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">weight</span>, y <span class="op">=</span> <span class="va">hindfoot_length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">source</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Removed 4812 rows containing missing values (geom_point).</code></pre>
</div>
<figure><img src="fig/04-putting-it-together-rendered-complete-plot-1.png" width="600" height="600" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints</h3>
<div class="callout-content">
<ul><li>it is always good to do preliminary investigations of new data</li>
<li>there are often many ways to achieve the same goal, describing them with plain English or pseudocode can help you choose an approach</li>
<li>the <code>read_delimited()</code> function can read tabular data from multiple file formats</li>
<li>joins are powerful ways to combine multiple datasets</li>
<li>it is a good idea to plan out the steps of your data cleaning and combining</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="03-working-with-data.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="05-extra-challenges.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="03-working-with-data.html" rel="prev"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous: Working with data</a>
        <a class="chapter-link float-end" href="05-extra-challenges.html" rel="next">Next: Extra Challenges... <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
				<p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
				<p><a href="https://github.com/MCMaurer/Rewrite-R-ecology-lesson/edit/main/episodes/04-putting-it-together.Rmd" class="external-link">Edit on Github</a> | <a href="https://github.com/MCMaurer/Rewrite-R-ecology-lesson/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a> | <a href="https://github.com/MCMaurer/Rewrite-R-ecology-lesson/" class="external-link">Source</a></p>
				<p><a href="https://github.com/MCMaurer/Rewrite-R-ecology-lesson/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">Template licensed under CC-BY 4.0</a> by <a href="https://carpentries.org" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper" class="external-link">sandpaper (0.9.0)</a>,
        <a href="https://github.com/carpentries/pegboard/tree/0.3.0" class="external-link">pegboard (0.3.0)</a>,
      and <a href="https://github.com/carpentries/varnish/tree/0.2.2" class="external-link">varnish (0.2.2)</a>.</p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
			<i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back to top"></i><br><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://MCMaurer.github.io/Rewrite-R-ecology-lesson/04-putting-it-together.html",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/0.9-DRAFT-2020_12_08",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software,data,lesson,The Carpentries",
  "name": "Putting it together",
  "creativeWorkStatus": "active",
  "url": "https://MCMaurer.github.io/Rewrite-R-ecology-lesson/04-putting-it-together.html",
  "identifier": "https://MCMaurer.github.io/Rewrite-R-ecology-lesson/04-putting-it-together.html",
  "dateCreated": "2022-06-09",
  "dateModified": "2022-07-26",
  "datePublished": "2022-07-26"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(['trackPageView']);
          _paq.push(['enableLinkTracking']);
          (function() {
              var u="https://carpentries.matomo.cloud/";
              _paq.push(['setTrackerUrl', u+'matomo.php']);
              _paq.push(['setSiteId', '1']);
              var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
              g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

